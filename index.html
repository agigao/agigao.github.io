<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2020-06-08 Mon 16:15 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>YEY Data Engineering</title>
<meta name="generator" content="Org mode" />
<meta name="author" content="Giga Chokheli" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
  /*]]>*/-->
</style>
<link rel="stylesheet" type="text/css" href="https://fniessen.github.io/org-html-themes/styles/readtheorg/css/htmlize.css"/>
<link rel="stylesheet" type="text/css" href="https://fniessen.github.io/org-html-themes/styles/readtheorg/css/readtheorg.css"/>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
<script type="text/javascript" src="https://fniessen.github.io/org-html-themes/styles/lib/js/jquery.stickytableheaders.min.js"></script>
<script type="text/javascript" src="https://fniessen.github.io/org-html-themes/styles/readtheorg/js/readtheorg.js"></script>
<style> #content{max-width:1800px;}</style>
<style> p{max-width:800px;}</style>
<style> li{max-width:800px;}</style
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2020 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        displayAlign: "center",
        displayIndent: "0em",

        "HTML-CSS": { scale: 100,
                        linebreaks: { automatic: "false" },
                        webFont: "TeX"
                       },
        SVG: {scale: 100,
              linebreaks: { automatic: "false" },
              font: "TeX"},
        NativeMML: {scale: 100},
        TeX: { equationNumbers: {autoNumber: "AMS"},
               MultLineWidth: "85%",
               TagSide: "right",
               TagIndent: ".8em"
             }
});
</script>
<script type="text/javascript"
        src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS_HTML"></script>
</head>
<body>
<div id="content">
<h1 class="title">YEY Data Engineering</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#orga3e43ea">1. March-April</a>
<ul>
<li><a href="#orgde10987">1.1. <span class="done DONE">DONE</span> Deduplication</a>
<ul>
<li><a href="#org5aa45b8">1.1.1. <span class="done DONE">DONE</span> Deduplication Module</a></li>
<li><a href="#orgfbddea8">1.1.2. <span class="done DONE">DONE</span> Recommender Integration</a></li>
<li><a href="#org20137dc">1.1.3. <span class="done DONE">DONE</span> Deploying to production</a></li>
</ul>
</li>
<li><a href="#org819df72">1.2. <span class="done DONE">DONE</span> My Travel Plans</a>
<ul>
<li><a href="#org949c233">1.2.1. <span class="done DONE">DONE</span> exploration of code/ideas</a></li>
<li><a href="#orgabcbfef">1.2.2. <span class="done DONE">DONE</span> implementation</a></li>
<li><a href="#orge3e14a3">1.2.3. <span class="done DONE">DONE</span> Result\Testing</a></li>
</ul>
</li>
<li><a href="#orge1cf255">1.3. <span class="done DONE">DONE</span> Limitations</a>
<ul>
<li><a href="#orgf41ba19">1.3.1. <span class="done DONE">DONE</span> Analysis</a></li>
<li><a href="#orgca2eac2">1.3.2. [X] Proposed solution</a></li>
<li><a href="#org1eb615c">1.3.3. <span class="done DONE">DONE</span> Implementation/Testing</a></li>
</ul>
</li>
<li><a href="#orge5193a5">1.4. <span class="done DONE">DONE</span> Subcategory Extraction</a>
<ul>
<li><a href="#orgf5abe57">1.4.1. <span class="done DONE">DONE</span> Analysis</a></li>
<li><a href="#org0800b71">1.4.2. <span class="done DONE">DONE</span> Implementation / Testing</a></li>
<li><a href="#org963e341">1.4.3. <span class="done DONE">DONE</span> Integration</a></li>
<li><a href="#org484824d">1.4.4. <span class="done DONE">DONE</span> Further Analysis and Report</a></li>
</ul>
</li>
<li><a href="#org8543fa3">1.5. QA</a>
<ul>
<li><a href="#org6ca576d">1.5.1. <span class="done DONE">DONE</span> More events than tickets</a></li>
<li><a href="#orgc2866a4">1.5.2. <span class="done DONE">DONE</span> The Structural Exploration</a></li>
<li><a href="#org26b7d71">1.5.3. <span class="done DONE">DONE</span> Data</a></li>
<li><a href="#org1edfcc4">1.5.4. <span class="done DONE">DONE</span> Go through the process</a></li>
</ul>
</li>
<li><a href="#orgfd49cb3">1.6. Errands</a>
<ul>
<li><a href="#orgeff6a37">1.6.1. <span class="todo TODO">TODO</span> XLS file to Database</a></li>
<li><a href="#org27963c1">1.6.2. <span class="done DONE">DONE</span> cleanup branches</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org3ac02f2">2. May</a>
<ul>
<li><a href="#org2156373">2.1. <span class="done DONE">DONE</span> QA</a></li>
<li><a href="#org2f32985">2.2. <span class="done DONE">DONE</span> Cheapest Ticket</a></li>
<li><a href="#orgda1b827">2.3. <span class="done DONE">DONE</span> YEY Structural Report</a></li>
<li><a href="#orga5b31c4">2.4. <span class="done DONE">DONE</span> Price Drop Detector</a></li>
<li><a href="#org5afc2cd">2.5. <span class="done DONE">DONE</span> Location Based Recommendations</a>
<ul>
<li><a href="#org0a1747d">2.5.1. <span class="done DONE">DONE</span> Unit Testing</a></li>
</ul>
</li>
<li><a href="#org20fc153">2.6. <span class="done DONE">DONE</span> Restructure the project</a>
<ul>
<li><a href="#orgd1725e3">2.6.1. New Structure</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org785278a">3. June</a>
<ul>
<li><a href="#orgc9a961e">3.1. <span class="done DONE">DONE</span> System Testing: the beginning</a></li>
<li><a href="#orgc5599e3">3.2. <span class="done DONE">DONE</span> Dev / Prod envs</a></li>
<li><a href="#org0da6de7">3.3. <span class="todo TODO">TODO</span> Small tasks</a>
<ul>
<li><a href="#org4d538e1">3.3.1. New Structure v2</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>


<div id="outline-container-orga3e43ea" class="outline-2">
<h2 id="orga3e43ea"><span class="section-number-2">1</span> March-April</h2>
<div class="outline-text-2" id="text-1">
</div>
<div id="outline-container-orgde10987" class="outline-3">
<h3 id="orgde10987"><span class="section-number-3">1.1</span> <span class="done DONE">DONE</span> Deduplication</h3>
<div class="outline-text-3" id="text-1-1">
</div>
<div id="outline-container-org5aa45b8" class="outline-4">
<h4 id="org5aa45b8"><span class="section-number-4">1.1.1</span> <span class="done DONE">DONE</span> Deduplication Module</h4>
<div class="outline-text-4" id="text-1-1-1">
<p>
A general idea is to avoid sending duplicate events to user.<br />
Solution: finding duplicates using 3 columns: event_time, venue, city.
if data in all these these match then the event is duplicate.
</p>
</div>
<ol class="org-ol">
<li><a id="org0fbcdfc"></a><span class="done DONE">DONE</span> Preliminary Exploration/Refresh<br />
<div class="outline-text-5" id="text-1-1-1-1">
<ul class="org-ul">
<li>Created 2 new tables and the original one was renamed.<br />
I dumped the current database data to my local Postgre server.<br />
Idea in general: split yey_event into to tables -&gt; yey_event_clean, yey_event_lookup.
<ul class="org-ul">
<li>yey_event_clean
<ul class="org-ul">
<li>original events with unique id's and duplicate links to lookup table.<br /></li>
<li>duplicate - 1/0</li>
</ul></li>
<li>yey_event_lookup
<ul class="org-ul">
<li>lookup table for keeping a link to the rest of duplicates events per original_id.</li>
<li>original_id - index.</li>
</ul></li>
</ul></li>
</ul>

<p>
Example:
</p>
<ul class="org-ul">
<li><p>
yey_event
</p>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-right" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-right">id</th>
<th scope="col" class="org-left">title</th>
<th scope="col" class="org-left">other details</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-right">001</td>
<td class="org-left">Pink Floyd</td>
<td class="org-left">venue, city, time - the same</td>
</tr>

<tr>
<td class="org-right">002</td>
<td class="org-left">Pink Floyd</td>
<td class="org-left">venue, city, time - the same</td>
</tr>

<tr>
<td class="org-right">&#x2026;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-right">005</td>
<td class="org-left">Led Zeppelin</td>
<td class="org-left">&#xa0;</td>
</tr>
</tbody>
</table></li>
<li><p>
yey_event_clean
</p>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-right" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-right" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-right">id</th>
<th scope="col" class="org-left">title</th>
<th scope="col" class="org-left">&#x2026;</th>
<th scope="col" class="org-right">duplicate</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-right">001</td>
<td class="org-left">Pink Floyd</td>
<td class="org-left">the same details</td>
<td class="org-right">1</td>
</tr>

<tr>
<td class="org-right">005</td>
<td class="org-left">Led Zeppelin</td>
<td class="org-left">&#x2026;</td>
<td class="org-right">0</td>
</tr>
</tbody>
</table></li>
<li><p>
yey_event_lookup
</p>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-right" />

<col  class="org-right" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-right">id</th>
<th scope="col" class="org-right">duplicate_id</th>
<th scope="col" class="org-left">&#x2026;</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-right">001</td>
<td class="org-right">002</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-right">001</td>
<td class="org-right">003</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-right">001</td>
<td class="org-right">004</td>
<td class="org-left">&#xa0;</td>
</tr>
</tbody>
</table></li>
</ul>
</div>
</li>

<li><a id="orgf366ae6"></a><span class="done DONE">DONE</span> Analyse PokerNews/Airbnb<br />
<div class="outline-text-5" id="text-1-1-1-2">
<p>
Caveats:
</p>
<ul class="org-ul">
<li>PokerNews:
<ul class="org-ul">
<li>No data</li>
</ul></li>
<li>Airbnb:
<ol class="org-ol">
<li>We don't have duplicates, for now.</li>
<li>Current solution won't work for duplication as we have a very general data for Airbnb records: in venue [city, state], city [city], also event_time is null.</li>
</ol></li>
</ul>
</div>
</li>

<li><a id="org4687364"></a><span class="done DONE">DONE</span> Testing<br />
<div class="outline-text-5" id="text-1-1-1-3">
<ul class="org-ul">
<li>Details:
Some extensive refactoring and testing has been done. I'm satisfied with the current result.<br />
<ul class="org-ul">
<li><p>
SQL for extra tests:
</p>
<div class="org-src-container">
<pre class="src src-sql">SELECT city,
       venue,
       event_time,
       event_source_id,
       COUNT(*)
FROM yey_event_clean
GROUP BY city, venue, event_time, event_source_id
HAVING COUNT(*) &gt; 1;
</pre>
</div>
<ul class="org-ul">
<li><p>
Result
</p>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">city</th>
<th scope="col" class="org-left">venue</th>
<th scope="col" class="org-left">event_time</th>
<th scope="col" class="org-right">event_source_id</th>
<th scope="col" class="org-right">count</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">Seattle</td>
<td class="org-left">Seattle, WA</td>
<td class="org-left">&#xa0;</td>
<td class="org-right">5</td>
<td class="org-right">2</td>
</tr>

<tr>
<td class="org-left">Cincinnati</td>
<td class="org-left">Cincinnati, OH</td>
<td class="org-left">&#xa0;</td>
<td class="org-right">5</td>
<td class="org-right">2</td>
</tr>

<tr>
<td class="org-left">San Francisco</td>
<td class="org-left">San Francisco, CA</td>
<td class="org-left">&#xa0;</td>
<td class="org-right">5</td>
<td class="org-right">2</td>
</tr>

<tr>
<td class="org-left">New York</td>
<td class="org-left">New York, NY</td>
<td class="org-left">&#xa0;</td>
<td class="org-right">5</td>
<td class="org-right">4</td>
</tr>
</tbody>
</table></li>
</ul></li>

<li><p>
So, yey_event_clean table must be a major table that will provide users with events, it's clean = free from duplicates. We have false positives for duplicate check due to null value in event_time column for Airbnb records.
</p>
<div class="org-src-container">
<pre class="src src-sql">SELECT *
FROM yey_event_clean
WHERE event_time IS NULL;
</pre>
</div>
<ul class="org-ul">
<li>Result: bunch of records from Airbnb, no duplicates though.</li>
</ul></li>
</ul></li>
</ul>
</div>
</li>
</ol>
</div>

<div id="outline-container-orgfbddea8" class="outline-4">
<h4 id="orgfbddea8"><span class="section-number-4">1.1.2</span> <span class="done DONE">DONE</span> Recommender Integration</h4>
<div class="outline-text-4" id="text-1-1-2">
</div>
<ol class="org-ol">
<li><a id="org7addb1a"></a><span class="done DONE">DONE</span> Implementation/Testing<br />
<div class="outline-text-5" id="text-1-1-2-1">
<ul class="org-ul">
<li>Findings
Out of 2040 events only 640 events have corresponding tickets.</li>
<li>Dealt with recommender integration through the following fashion:
<ul class="org-ul">
<li>querying events through yey_event_clean</li>
<li>joining yey_ticket event_id on yey_event_lookup id upon querying tickets!</li>
</ul></li>
<li>outliers: somehow some events tend to differ in terms of date by 1 day, they're obviously duplicates.</li>
</ul>
</div>
</li>
</ol>
</div>

<div id="outline-container-org20137dc" class="outline-4">
<h4 id="org20137dc"><span class="section-number-4">1.1.3</span> <span class="done DONE">DONE</span> Deploying to production</h4>
<div class="outline-text-4" id="text-1-1-3">
</div>
<ol class="org-ol">
<li><a id="orgb99ced1"></a><span class="done DONE">DONE</span> Creating new tables<br />
<div class="outline-text-5" id="text-1-1-3-1">
<p>
yey_event_clean, yey_event_lookup
</p>
</div>
</li>
<li><a id="org0e0aeea"></a><span class="done DONE">DONE</span> Integrating into the process<br />
<div class="outline-text-5" id="text-1-1-3-2">
<ul class="org-ul">
<li>unifying under a single script.</li>
</ul>
</div>
</li>
<li><a id="org8199c14"></a><span class="done DONE">DONE</span> Testing<br /></li>
</ol>
</div>
</div>
<div id="outline-container-org819df72" class="outline-3">
<h3 id="org819df72"><span class="section-number-3">1.2</span> <span class="done DONE">DONE</span> My Travel Plans</h3>
<div class="outline-text-3" id="text-1-2">
<p>
Decision - in case of travel destinations send 6 events from tr/destinations.
</p>
</div>
<div id="outline-container-org949c233" class="outline-4">
<h4 id="org949c233"><span class="section-number-4">1.2.1</span> <span class="done DONE">DONE</span> exploration of code/ideas</h4>
</div>
<div id="outline-container-orgabcbfef" class="outline-4">
<h4 id="orgabcbfef"><span class="section-number-4">1.2.2</span> <span class="done DONE">DONE</span> implementation</h4>
<div class="outline-text-4" id="text-1-2-2">
<ul class="org-ul">
<li>6 from preferred location / 6 from travel plans</li>
<li>current issues:
<ul class="org-ul">
<li>duplications eventually across the travel destinations - the same event id for 2 diff. travel destinations - gotta figure out how/why?</li>
<li>So, the most important part - figuring out how to flag or merge regular events and multiple travel destinations under the same ID:
<ul class="org-ul">
<li><p>
Should we add additional columns for each travel destination to the original table?
But it will become something like:
</p>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">id</th>
<th scope="col" class="org-left">regular</th>
<th scope="col" class="org-left">state_1</th>
<th scope="col" class="org-left">city_1</th>
<th scope="col" class="org-left">start_date_1</th>
<th scope="col" class="org-left">end_date_1</th>
<th scope="col" class="org-left">state_2</th>
<th scope="col" class="org-left">city_2</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>
</tbody>
</table>
<p>
etc.
which isn't a good solution.
</p></li>

<li><p>
Can it be queried and merged together upon sending?
a list will be flagged as travel destination
</p>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-right" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-right">id</th>
<th scope="col" class="org-left">state</th>
<th scope="col" class="org-left">city</th>
<th scope="col" class="org-left">start date</th>
<th scope="col" class="org-left">end date</th>
<th scope="col" class="org-left">travel destination</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-right">5</td>
<td class="org-left">MA</td>
<td class="org-left">Boston</td>
<td class="org-left">&#x2026;</td>
<td class="org-left">&#x2026;</td>
<td class="org-left">True</td>
</tr>

<tr>
<td class="org-right">5</td>
<td class="org-left">MA</td>
<td class="org-left">Watertown</td>
<td class="org-left">&#x2026;</td>
<td class="org-left">&#x2026;</td>
<td class="org-left">True</td>
</tr>
</tbody>
</table>
<p>
And upon building an email it will nicely put headlines for:
</p>
<ol class="org-ol">
<li>Events for Following destination: State/City, Date:
events</li>
<li>Another Travel destination
events</li>
<li>Preferred location
events</li>
</ol>

<p>
<b><b>So, basically the fundamental question is how does the front/email sender queries the yey_useremailqueue table?</b></b>
</p></li>
</ul></li>
</ul></li>
</ul>
</div>
</div>

<div id="outline-container-orge3e14a3" class="outline-4">
<h4 id="orge3e14a3"><span class="section-number-4">1.2.3</span> <span class="done DONE">DONE</span> Result\Testing</h4>
<div class="outline-text-4" id="text-1-2-3">
<ul class="org-ul">
<li>So, the process is implemented and works fine, just distribution of events has to be re-adjusted.</li>
<li><p>
yey_useremailqueue_tickets:
</p>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-right">id</th>
<th scope="col" class="org-right">useremailqueue_id</th>
<th scope="col" class="org-right">ticket_id</th>
<th scope="col" class="org-left">travel</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-right">1</td>
<td class="org-right">15</td>
<td class="org-right">738695</td>
<td class="org-left">True</td>
</tr>

<tr>
<td class="org-right">2</td>
<td class="org-right">15</td>
<td class="org-right">678910</td>
<td class="org-left">False</td>
</tr>

<tr>
<td class="org-right">3</td>
<td class="org-right">15</td>
<td class="org-right">754143</td>
<td class="org-left">&#x2026;</td>
</tr>

<tr>
<td class="org-right">4</td>
<td class="org-right">15</td>
<td class="org-right">1099247</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-right">5</td>
<td class="org-right">15</td>
<td class="org-right">1099703</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-right">6</td>
<td class="org-right">15</td>
<td class="org-right">1096048</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-right">7</td>
<td class="org-right">17</td>
<td class="org-right">738694</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-right">8</td>
<td class="org-right">17</td>
<td class="org-right">754138</td>
<td class="org-left">&#xa0;</td>
</tr>
</tbody>
</table>
<p>
Yes, right now I realized we need them sorted by user_id, travel [True comes first]
</p></li>
<li>Limit event to X, <br />
So, in config file we have two constants STANDARD_EVENTS_LIMIT_PER_USER and TRAVEL_EVENTS_LIMIT_PER_USER, value of both is 6 right now, as suggested. Adjusting this constant will change a number of events/tickets for each type(standard/travel) that end up in a user's inbox.</li>
</ul>
</div>
</div>
</div>

<div id="outline-container-orge1cf255" class="outline-3">
<h3 id="orge1cf255"><span class="section-number-3">1.3</span> <span class="done DONE">DONE</span> Limitations</h3>
<div class="outline-text-3" id="text-1-3">
</div>

<div id="outline-container-orgf41ba19" class="outline-4">
<h4 id="orgf41ba19"><span class="section-number-4">1.3.1</span> <span class="done DONE">DONE</span> Analysis</h4>
<div class="outline-text-4" id="text-1-3-1">
<ul class="org-ul">
<li>How many offers a user gets on average for the same event?</li>
</ul>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-right" />

<col  class="org-right" />

<col  class="org-left" />

<col  class="org-right" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-right">user_id</th>
<th scope="col" class="org-right">ticket_id</th>
<th scope="col" class="org-left">email_ids</th>
<th scope="col" class="org-right">count</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-right">4</td>
<td class="org-right">5017504</td>
<td class="org-left">{3340,1712}</td>
<td class="org-right">2</td>
</tr>

<tr>
<td class="org-right">4</td>
<td class="org-right">5018132</td>
<td class="org-left">{3340,1712}</td>
<td class="org-right">2</td>
</tr>

<tr>
<td class="org-right">4</td>
<td class="org-right">5018175</td>
<td class="org-left">{3340,1712}</td>
<td class="org-right">2</td>
</tr>

<tr>
<td class="org-right">4</td>
<td class="org-right">5019129</td>
<td class="org-left">{1712,3340}</td>
<td class="org-right">2</td>
</tr>

<tr>
<td class="org-right">17</td>
<td class="org-right">5018084</td>
<td class="org-left">{2257,1715}</td>
<td class="org-right">2</td>
</tr>

<tr>
<td class="org-right">17</td>
<td class="org-right">5018087</td>
<td class="org-left">{3343,2799}</td>
<td class="org-right">2</td>
</tr>

<tr>
<td class="org-right">17</td>
<td class="org-right">6001050</td>
<td class="org-left">{2799,2257}</td>
<td class="org-right">2</td>
</tr>
</tbody>
</table>
<ol class="org-ol">
<li>In a current state of <b><b>useremailqueue</b></b> table, the answer 2. <br />
Currently max reoccurance is 2 (not &gt; 3, as original email suggested this number as the upper limit)</li>
<li>Number of the same events that were sent to the same user across email is 7; 2.1% of all unique tickets(events) in the sent
emails.</li>
<li>Other facts - currently 332 unique events are distributed through 547 emails.</li>
</ol>
</div>
</div>

<div id="outline-container-orgca2eac2" class="outline-4">
<h4 id="orgca2eac2"><span class="section-number-4">1.3.2</span> [X] Proposed solution</h4>
<div class="outline-text-4" id="text-1-3-2">
<ul class="org-ul">
<li>How to limit the same event offer for the user? <br />
a new lookup table and then filtering the events out for the user during
recommendation process according this table.</li>
</ul>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-right">user_id</th>
<th scope="col" class="org-right">event_id</th>
<th scope="col" class="org-right">counter</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-right">1</td>
<td class="org-right">100</td>
<td class="org-right">1</td>
</tr>

<tr>
<td class="org-right">1</td>
<td class="org-right">101</td>
<td class="org-right">1</td>
</tr>

<tr>
<td class="org-right">1</td>
<td class="org-right">102</td>
<td class="org-right">1</td>
</tr>

<tr>
<td class="org-right">1</td>
<td class="org-right">103</td>
<td class="org-right">2</td>
</tr>
</tbody>
</table>
<ul class="org-ul">
<li>Estimated time for the task [implementation/testing] 8 hours + 6 hours buffer.</li>
</ul>
</div>
</div>

<div id="outline-container-org1eb615c" class="outline-4">
<h4 id="org1eb615c"><span class="section-number-4">1.3.3</span> <span class="done DONE">DONE</span> Implementation/Testing</h4>
<div class="outline-text-4" id="text-1-3-3">
<p>
So, the following solution was implemented - instead of creating a new table, a
regular query was used for getting repetition counter (with &gt; 3) of each event grouped
according the user.
</p>
<ul class="org-ul">
<li>the result - a runtime data table, used throughout the process for
filtering out events.</li>
</ul>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-right">user_id</th>
<th scope="col" class="org-right">event_id</th>
<th scope="col" class="org-right">count</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-right">17</td>
<td class="org-right">17385300</td>
<td class="org-right">5</td>
</tr>

<tr>
<td class="org-right">17</td>
<td class="org-right">17414056</td>
<td class="org-right">4</td>
</tr>

<tr>
<td class="org-right">17</td>
<td class="org-right">17414072</td>
<td class="org-right">5</td>
</tr>

<tr>
<td class="org-right">17</td>
<td class="org-right">17414076</td>
<td class="org-right">8</td>
</tr>
</tbody>
</table>
<ul class="org-ul">
<li>Limit modifier: <b><b>MAX_REPEATED_USER_EVENTS</b></b> in <b><b>config.yml</b></b> file, L12, set to 3 right now.</li>
<li>new branch <b><b>dev</b></b> was also introduced instead of creating a new branch for
each new small feature.</li>
</ul>
</div>
</div>
</div>
<div id="outline-container-orge5193a5" class="outline-3">
<h3 id="orge5193a5"><span class="section-number-3">1.4</span> <span class="done DONE">DONE</span> Subcategory Extraction</h3>
<div class="outline-text-3" id="text-1-4">
</div>
<div id="outline-container-orgf5abe57" class="outline-4">
<h4 id="orgf5abe57"><span class="section-number-4">1.4.1</span> <span class="done DONE">DONE</span> Analysis</h4>
<div class="outline-text-4" id="text-1-4-1">
<ul class="org-ul">
<li><p>
Time estimations
</p>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Task</th>
<th scope="col" class="org-right">Hours</th>
<th scope="col" class="org-right">Buffer</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">Subcategories - Exploration</td>
<td class="org-right">8</td>
<td class="org-right">4</td>
</tr>

<tr>
<td class="org-left">Subcategories - Implementation</td>
<td class="org-right">10</td>
<td class="org-right">4</td>
</tr>
</tbody>
</table></li>
</ul>

<p>
yey_event title -&gt; subcategory_id
</p>

<ul class="org-ul">
<li><p>
Exploration
</p>
<div class="org-src-container">
<pre class="src src-sql">SELECT data.*, cat.name as event_category_name
         FROM (SELECT --yec.link,
                      events.title          as events_title,
                      subcat.id             as subcat_id,
                      subcat.name           as category_name,
                      -- events.subcategory_id as events_subcategory_id,
                      events.category_id    as event_category_id,
                      cat.id                as cat_id,
                      cat.name              as cat_name
               FROM yey_event_clean as events
                        JOIN yey_subcategory as subcat
                             on events.title LIKE '%' || subcat.name || '%'
                        JOIN yey_category cat on subcat.category_id = cat.id
                  WHERE events.category_id &lt;&gt; subcat.category_id -- comment out for complete list
              ) as data
                  JOIN yey_category cat on data.event_category_id = cat.id
</pre>
</div></li>
<li>Result</li>
</ul>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-right" />

<col  class="org-left" />

<col  class="org-right" />

<col  class="org-left" />

<col  class="org-right" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">events_title</th>
<th scope="col" class="org-right">subcat_id</th>
<th scope="col" class="org-left">category_name</th>
<th scope="col" class="org-right">event_category_id</th>
<th scope="col" class="org-left">event_category_name</th>
<th scope="col" class="org-right">cat_id</th>
<th scope="col" class="org-left">cat_name</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">Miami Hurricanes at Florida Gulf Coast Eagles Basketball</td>
<td class="org-right">532</td>
<td class="org-left">Eagles</td>
<td class="org-right">3</td>
<td class="org-left">Basketball</td>
<td class="org-right">10</td>
<td class="org-left">Rock</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-left">Wayne Brady</td>
<td class="org-right">768</td>
<td class="org-left">Wayne Brady</td>
<td class="org-right">21</td>
<td class="org-left">Theater</td>
<td class="org-right">14</td>
<td class="org-left">R&amp;B</td>
</tr>

<tr>
<td class="org-left">Gabriel Iglesias Tickets (16+ Event)</td>
<td class="org-right">937</td>
<td class="org-left">Gabriel Iglesias</td>
<td class="org-right">21</td>
<td class="org-left">Theater</td>
<td class="org-right">18</td>
<td class="org-left">Latin</td>
</tr>

<tr>
<td class="org-left">Gabriel Iglesias Tickets (16+ Event)</td>
<td class="org-right">1134</td>
<td class="org-left">Gabriel Iglesias</td>
<td class="org-right">21</td>
<td class="org-left">Theater</td>
<td class="org-right">22</td>
<td class="org-left">Comedy</td>
</tr>

<tr>
<td class="org-left">Houston Symphony: Andrés Conducts Mahler 7</td>
<td class="org-right">1038</td>
<td class="org-left">Houston Symphony</td>
<td class="org-right">21</td>
<td class="org-left">Theater</td>
<td class="org-right">20</td>
<td class="org-left">Classical</td>
</tr>
</tbody>
</table>
<ul class="org-ul">
<li>Problems
<ul class="org-ul">
<li>We have false positives due to name overlap, for example Eagles [rock band] and
Boston College Eagles [football], we gotta check for category id as well.</li>
<li>category_id:
<ul class="org-ul">
<li>yey_events table categories do mismatch with yey_category data: R&amp;B in
yey_category, Theater in yey_events. Classical in yey_category, Theater in
yey_events.</li>
</ul></li>
<li>Stats: [in my local data] we got 17279 records in total that match to yey_subcategory name field, but
without category_id check we have 15% error rate, 2449 cases.</li>
</ul></li>

<li>Questions
<ul class="org-ul">
<li>Well, I checked a few links and for example Mahler 7th Symphony on a
list is under <b>Classical</b> at the source page, although <b><b>Theater</b></b> is top
levle category, hence in our data it ends up in
Theater - <a href="https://www.stubhub.com/houston-symphony-tickets/performer/16088/">link</a>.
<ul class="org-ul">
<li>Is there any way to adjust this in scrapers/api calls?</li>
</ul></li>

<li>Levenstein and his peers
They solve another kind of problem - how many changes one needs for string a
to make it identical to b. We're not looking for string equality, as title
will always be larger than subcategory name.
<ul class="org-ul">
<li>Our problem is solved by the following approach: find <b><b>longest common substring similarity</b></b>, what % of
string b [category name] is included in string a [yey_event title]. This
approach also takles typo issues, for example Pink Floyd in category and Pin
Floyd in the title.</li>
</ul></li>
</ul></li>
</ul>
</div>
</div>

<div id="outline-container-org0800b71" class="outline-4">
<h4 id="org0800b71"><span class="section-number-4">1.4.2</span> <span class="done DONE">DONE</span> Implementation / Testing</h4>
<div class="outline-text-4" id="text-1-4-2">
</div>
<ol class="org-ol">
<li><a id="orgcd879e0"></a><span class="done DONE">DONE</span> Convert deduplication to indicate more generalized purpose -&gt; [data] cleaning.<br /></li>
<li><a id="orge19a547"></a><span class="done DONE">DONE</span> Subcategory extraction:<br />
<div class="outline-text-5" id="text-1-4-2-2">
<ul class="org-ul">
<li>Test Algorithms and find the most accurate approach.</li>
<li>Notes
<ul class="org-ul">
<li>How many events do we have without category_ids?</li>
<li>How many without cat ids but with matching subcat name?
<ul class="org-ul">
<li>NONE</li>
</ul></li>

<li>What happens if for example we have Alabama Crimson Tide in basketball and football.
<ul class="org-ul">
<li>Umm, we compare both, categories as well, so, it'll filter them out.</li>
</ul></li>

<li>Check all mismatches in event_caregory id and category id
<ul class="org-ul">
<li>Done</li>
</ul></li>

<li>What happens if we have overlay of events/categories?
<ul class="org-ul">
<li>We won't, anymore.</li>
</ul></li>

<li>General idea:
<ul class="org-ul">
<li>filter events according category</li>
<li>filter according name similarity</li>
<li>assign subcategory_id</li>
</ul></li>

<li>[Yoav] Under $50
<ul class="org-ul">
<li>Do we want to fill this category as well?</li>
</ul></li>

<li><p>
Category clusterization
</p>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-right" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-right">ids</th>
<th scope="col" class="org-left">cats</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-right">1-9</td>
<td class="org-left">sports</td>
</tr>

<tr>
<td class="org-right">10-19</td>
<td class="org-left">various music</td>
</tr>

<tr>
<td class="org-right">20-22</td>
<td class="org-left">classical/theater/comedy</td>
</tr>

<tr>
<td class="org-right">23+</td>
<td class="org-left">the rest</td>
</tr>
</tbody>
</table></li>

<li><p>
Categories:
</p>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-right" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-right">id</th>
<th scope="col" class="org-left">Category</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-right">1</td>
<td class="org-left">Football</td>
</tr>

<tr>
<td class="org-right">2</td>
<td class="org-left">Baseball</td>
</tr>

<tr>
<td class="org-right">3</td>
<td class="org-left">Basketball</td>
</tr>

<tr>
<td class="org-right">4</td>
<td class="org-left">Hockey</td>
</tr>

<tr>
<td class="org-right">5</td>
<td class="org-left">Tennis</td>
</tr>

<tr>
<td class="org-right">6</td>
<td class="org-left">Soccer</td>
</tr>

<tr>
<td class="org-right">7</td>
<td class="org-left">Golf</td>
</tr>

<tr>
<td class="org-right">8</td>
<td class="org-left">Wrestling</td>
</tr>

<tr>
<td class="org-right">9</td>
<td class="org-left">Boxing</td>
</tr>

<tr>
<td class="org-right">10</td>
<td class="org-left">Rock</td>
</tr>

<tr>
<td class="org-right">11</td>
<td class="org-left">Pop</td>
</tr>

<tr>
<td class="org-right">12</td>
<td class="org-left">Hip Hop</td>
</tr>

<tr>
<td class="org-right">13</td>
<td class="org-left">Country</td>
</tr>

<tr>
<td class="org-right">14</td>
<td class="org-left">R&amp;B</td>
</tr>

<tr>
<td class="org-right">15</td>
<td class="org-left">Electronic</td>
</tr>

<tr>
<td class="org-right">16</td>
<td class="org-left">Jazz</td>
</tr>

<tr>
<td class="org-right">17</td>
<td class="org-left">Blues</td>
</tr>

<tr>
<td class="org-right">18</td>
<td class="org-left">Latin</td>
</tr>

<tr>
<td class="org-right">19</td>
<td class="org-left">Christian</td>
</tr>

<tr>
<td class="org-right">20</td>
<td class="org-left">Classical</td>
</tr>

<tr>
<td class="org-right">21</td>
<td class="org-left">Theater</td>
</tr>

<tr>
<td class="org-right">22</td>
<td class="org-left">Comedy</td>
</tr>

<tr>
<td class="org-right">23</td>
<td class="org-left">Food Tour</td>
</tr>

<tr>
<td class="org-right">24</td>
<td class="org-left">Most Popular</td>
</tr>

<tr>
<td class="org-right">25</td>
<td class="org-left">Coming Soon</td>
</tr>

<tr>
<td class="org-right">26</td>
<td class="org-left">Under $50</td>
</tr>

<tr>
<td class="org-right">27</td>
<td class="org-left">Staff Picks</td>
</tr>
</tbody>
</table></li>
</ul></li>
</ul>
</div>
</li>

<li><a id="orgc7a85ae"></a>Current state 21/04<br />
<div class="outline-text-5" id="text-1-4-2-3">
<p>
majority of the job is complete, also exact matches have been dealt with. We no
longer mistake Eagles rock band with some football or basketball teams.
</p>
<ul class="org-ul">
<li>ongoing process is to tackle similarity issue in case of typos or other
errors.</li>
<li><p>
Further analysis - exactly which music event categories fall under
Theater.
</p>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-right" />

<col  class="org-left" />

<col  class="org-right" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">event_cat_name</th>
<th scope="col" class="org-right">event_cat_id</th>
<th scope="col" class="org-left">orig_cat_name</th>
<th scope="col" class="org-right">orig_cat_id</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">Football</td>
<td class="org-right">1</td>
<td class="org-left">Basketball</td>
<td class="org-right">3</td>
</tr>

<tr>
<td class="org-left">Football</td>
<td class="org-right">1</td>
<td class="org-left">Country</td>
<td class="org-right">13</td>
</tr>

<tr>
<td class="org-left">Football</td>
<td class="org-right">1</td>
<td class="org-left">Hip Hop</td>
<td class="org-right">12</td>
</tr>

<tr>
<td class="org-left">Football</td>
<td class="org-right">1</td>
<td class="org-left">Rock</td>
<td class="org-right">10</td>
</tr>

<tr>
<td class="org-left">Football</td>
<td class="org-right">1</td>
<td class="org-left">Theater</td>
<td class="org-right">21</td>
</tr>

<tr>
<td class="org-left">Hip Hop</td>
<td class="org-right">12</td>
<td class="org-left">Latin</td>
<td class="org-right">18</td>
</tr>

<tr>
<td class="org-left">Hip Hop</td>
<td class="org-right">12</td>
<td class="org-left">R&amp;B</td>
<td class="org-right">14</td>
</tr>

<tr>
<td class="org-left">Hip Hop</td>
<td class="org-right">12</td>
<td class="org-left">Rock</td>
<td class="org-right">10</td>
</tr>

<tr>
<td class="org-left">Hip Hop</td>
<td class="org-right">12</td>
<td class="org-left">Theater</td>
<td class="org-right">21</td>
</tr>

<tr>
<td class="org-left">Country</td>
<td class="org-right">13</td>
<td class="org-left">Blues</td>
<td class="org-right">17</td>
</tr>

<tr>
<td class="org-left">Country</td>
<td class="org-right">13</td>
<td class="org-left">Classical</td>
<td class="org-right">20</td>
</tr>

<tr>
<td class="org-left">Country</td>
<td class="org-right">13</td>
<td class="org-left">Comedy</td>
<td class="org-right">22</td>
</tr>

<tr>
<td class="org-left">Country</td>
<td class="org-right">13</td>
<td class="org-left">Electronic</td>
<td class="org-right">15</td>
</tr>

<tr>
<td class="org-left">Country</td>
<td class="org-right">13</td>
<td class="org-left">Pop</td>
<td class="org-right">11</td>
</tr>

<tr>
<td class="org-left">Country</td>
<td class="org-right">13</td>
<td class="org-left">Rock</td>
<td class="org-right">10</td>
</tr>

<tr>
<td class="org-left">Country</td>
<td class="org-right">13</td>
<td class="org-left">Theater</td>
<td class="org-right">21</td>
</tr>

<tr>
<td class="org-left">Country</td>
<td class="org-right">13</td>
<td class="org-left">Wrestling</td>
<td class="org-right">8</td>
</tr>

<tr>
<td class="org-left">Baseball</td>
<td class="org-right">2</td>
<td class="org-left">Basketball</td>
<td class="org-right">3</td>
</tr>

<tr>
<td class="org-left">Baseball</td>
<td class="org-right">2</td>
<td class="org-left">Boxing</td>
<td class="org-right">9</td>
</tr>

<tr>
<td class="org-left">Baseball</td>
<td class="org-right">2</td>
<td class="org-left">Country</td>
<td class="org-right">13</td>
</tr>

<tr>
<td class="org-left">Baseball</td>
<td class="org-right">2</td>
<td class="org-left">Football</td>
<td class="org-right">1</td>
</tr>

<tr>
<td class="org-left">Baseball</td>
<td class="org-right">2</td>
<td class="org-left">Hip Hop</td>
<td class="org-right">12</td>
</tr>

<tr>
<td class="org-left">Baseball</td>
<td class="org-right">2</td>
<td class="org-left">Rock</td>
<td class="org-right">10</td>
</tr>

<tr>
<td class="org-left">Baseball</td>
<td class="org-right">2</td>
<td class="org-left">Theater</td>
<td class="org-right">21</td>
</tr>

<tr>
<td class="org-left">Theater</td>
<td class="org-right">21</td>
<td class="org-left">Christian</td>
<td class="org-right">19</td>
</tr>

<tr>
<td class="org-left">Theater</td>
<td class="org-right">21</td>
<td class="org-left">Classical</td>
<td class="org-right">20</td>
</tr>

<tr>
<td class="org-left">Theater</td>
<td class="org-right">21</td>
<td class="org-left">Comedy</td>
<td class="org-right">22</td>
</tr>

<tr>
<td class="org-left">Theater</td>
<td class="org-right">21</td>
<td class="org-left">Country</td>
<td class="org-right">13</td>
</tr>

<tr>
<td class="org-left">Theater</td>
<td class="org-right">21</td>
<td class="org-left">Electronic</td>
<td class="org-right">15</td>
</tr>

<tr>
<td class="org-left">Theater</td>
<td class="org-right">21</td>
<td class="org-left">Hip Hop</td>
<td class="org-right">12</td>
</tr>

<tr>
<td class="org-left">Theater</td>
<td class="org-right">21</td>
<td class="org-left">Latin</td>
<td class="org-right">18</td>
</tr>

<tr>
<td class="org-left">Theater</td>
<td class="org-right">21</td>
<td class="org-left">Pop</td>
<td class="org-right">11</td>
</tr>

<tr>
<td class="org-left">Theater</td>
<td class="org-right">21</td>
<td class="org-left">Rock</td>
<td class="org-right">10</td>
</tr>

<tr>
<td class="org-left">Basketball</td>
<td class="org-right">3</td>
<td class="org-left">Electronic</td>
<td class="org-right">15</td>
</tr>

<tr>
<td class="org-left">Basketball</td>
<td class="org-right">3</td>
<td class="org-left">Rock</td>
<td class="org-right">10</td>
</tr>

<tr>
<td class="org-left">Basketball</td>
<td class="org-right">3</td>
<td class="org-left">Theater</td>
<td class="org-right">21</td>
</tr>

<tr>
<td class="org-left">Hockey</td>
<td class="org-right">4</td>
<td class="org-left">Rock</td>
<td class="org-right">10</td>
</tr>

<tr>
<td class="org-left">Hockey</td>
<td class="org-right">4</td>
<td class="org-left">Theater</td>
<td class="org-right">21</td>
</tr>
</tbody>
</table></li>
</ul>



<ul class="org-ul">
<li>Example (a sneak peek):</li>
</ul>
<div class="org-src-container">
<pre class="src src-python">for t in combinations(title, len(name.split())):
    sim = td.jaro_winkler.normalized_similarity(t, name)
    if sim &gt; 0.0:
        print(f'Similarity: {sim}, {t} - {name}')

"""
Similarity: 1.0, Alabama Crimson Tide - Alabama Crimson Tide
Similarity: 0.6025030525030525, Crimson Tide Football - Alabama Crimson Tide
Similarity: 0.44439775910364143, Tide Football vs. - Alabama Crimson Tide
Similarity: 0.5666666666666667, Football vs. Georgia - Alabama Crimson Tide
Similarity: 0.4750000000000001, vs. Georgia Bulldogs - Alabama Crimson Tide
Similarity: 0.45518518518518514, Georgia Bulldogs Football - Alabama Crimson Tide
Similarity: 0.3813725490196078, Bulldogs Football - Alabama Crimson Tide
Similarity: 0.39722222222222214, Football - Alabama Crimson Tide
"""
</pre>
</div>
</div>
</li>

<li><a id="orgef462ed"></a>Notes 22/04<br />
<div class="outline-text-5" id="text-1-4-2-4">
<ul class="org-ul">
<li>Observation: yey_event_clean got 7873 unique strings in title column out of
55K.</li>

<li><p>
Latin added to Theater category in the process of checking categories:
</p>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-right" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-right">id</th>
<th scope="col" class="org-left">name</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-right">18</td>
<td class="org-left">Latin</td>
</tr>

<tr>
<td class="org-right">20</td>
<td class="org-left">Classical</td>
</tr>

<tr>
<td class="org-right">21</td>
<td class="org-left">Theater</td>
</tr>

<tr>
<td class="org-right">22</td>
<td class="org-left">Comedy</td>
</tr>
</tbody>
</table></li>
</ul>
</div>


<ol class="org-ol">
<li><a id="orgd465e60"></a>Analysis/tweaks<br />
<div class="outline-text-6" id="text-1-4-2-4-1">
<ol class="org-ol">
<li><p>
first version - using full yey_event table
</p>
<div class="org-src-container">
<pre class="src src-bash">python exploration.py  2419,35s user 1,30s system 99% cpu 40:24,63 total
</pre>
</div></li>
<li><p>
second version - using unique dataframe filtered through titles and
then joined over title.
</p>
<div class="org-src-container">
<pre class="src src-bash">python exploration.py  396,12s user 0,44s system 99% cpu 6:36,65 total
</pre>
</div>
<p>
By this approach we went from 40 minutes to 6, performance increased
almost 7 fold.
</p>

<ul class="org-ul">
<li><p>
I think similarity check [technically] works quite quite well,
eventually I settled down on Levenstein algorithm after couple of
tricks in the process. Instead of checking name directly in the title,
I'm creating n combinations out of title and then checking using
the algorithm, which basically measures a number of changes that are
required to make 2 strings equal.
</p>
<div class="org-src-container">
<pre class="src src-python">title = 'Sacramento River Cats at Las Vegas Aviators'
name = 'Sacremento River Cats'

combs = combinations(title, name);
combs
# Here we got combinations out of title
# number of element in the combinations == number of elements in the name.
"""
['Sacramento River Cats',
'River Cats at',
'Cats at Las',
'at Las Vegas',
'Las Vegas Aviators',
'Vegas Aviators',
'Aviators']
"""
for c in combs:
    sim = td.levenshtein.normalized_similarity(c, name)
    print(f'Similarity: {sim}, {c} - {name}')

"""
Similarity: 0.9523809523809523, Sacramento River Cats - Sacremento River Cats
Similarity: 0.33333333333333337, River Cats at - Sacremento River Cats
Similarity: 0.2857142857142857, Cats at Las - Sacremento River Cats
Similarity: 0.23809523809523814, at Las Vegas - Sacremento River Cats
Similarity: 0.23809523809523814, Las Vegas Aviators - Sacremento River Cats
Similarity: 0.19047619047619047, Vegas Aviators - Sacremento River Cats
Similarity: 0.19047619047619047, Aviators - Sacremento River Cats
"""
</pre>
</div></li>
</ul></li>

<li><p>
Extraction from the list of cases where partial similarity check was
required:
</p>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-right" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">name</th>
<th scope="col" class="org-left">title</th>
<th scope="col" class="org-right">sim</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">Sacremento River Cats</td>
<td class="org-left">Sacramento River Cats at Reno Aces</td>
<td class="org-right">0.9523809523809523</td>
</tr>

<tr>
<td class="org-left">Ain't Too Proud</td>
<td class="org-left">Aint Too Proud Baltimore</td>
<td class="org-right">0.9333333333333333</td>
</tr>

<tr>
<td class="org-left">Come From Away</td>
<td class="org-left">Come from Away</td>
<td class="org-right">0.9285714285714286</td>
</tr>

<tr>
<td class="org-left">Kiss Me, Kate</td>
<td class="org-left">Kiss Me Kate Lincolnshire</td>
<td class="org-right">0.9230769230769231</td>
</tr>

<tr>
<td class="org-left">Moulin Rouge!</td>
<td class="org-left">Moulin Rouge The Musical Los Angeles</td>
<td class="org-right">0.9230769230769231</td>
</tr>

<tr>
<td class="org-left">The Band's Visit</td>
<td class="org-left">The Bands Visit Richmond Tickets (Rescheduled from May 3, 2020)</td>
<td class="org-right">0.9375</td>
</tr>

<tr>
<td class="org-left">The Book of Mormon</td>
<td class="org-left">The Book Of Mormon (New York, NY)</td>
<td class="org-right">0.9444444444444444</td>
</tr>

<tr>
<td class="org-left">Tina - The Tina Turner Musical</td>
<td class="org-left">TINA - The Tina Turner Musical (NY)</td>
<td class="org-right">0.9</td>
</tr>

<tr>
<td class="org-left">To Kill a Mockingbird</td>
<td class="org-left">To Kill A Mockingbird New York</td>
<td class="org-right">0.9523809523809523</td>
</tr>

<tr>
<td class="org-left">What the Constitution Means to Me</td>
<td class="org-left">What The Constitution Means To Me (Chicago)</td>
<td class="org-right">0.9393939393939394</td>
</tr>
</tbody>
</table></li>

<li>Questions [Yoav]
<ul class="org-ul">
<li>We have a typo in yey_subcategory table,
SacrEmento -&gt; SacrAmento, the latter one is correct. <br />
I think we should check this column for typos in general.</li>

<li>We have a joint concerts for example by Korn and System of a Down,
which fall under the Theater category. How should we deal with this?
I gotta think.</li>

<li>We got some theater shows about Cher and Rolling Stones, should they
be included under the subcategory: rolling stones or cher? I think
these cases are outliers.</li>
</ul></li>
</ol>
</div>
</li>
</ol>
</li>
</ol>
</div>
<div id="outline-container-org963e341" class="outline-4">
<h4 id="org963e341"><span class="section-number-4">1.4.3</span> <span class="done DONE">DONE</span> Integration</h4>
<div class="outline-text-4" id="text-1-4-3">
<p>
Well, the source is ready, 23/04 integration into the system and final testing.
</p>
</div>
<ol class="org-ol">
<li><a id="orge8f73db"></a>Notes 23/04<br />
<div class="outline-text-5" id="text-1-4-3-1">
<ul class="org-ul">
<li>It turns out we have subcategory duplicates in <b><b>yey_subcategory</b></b>, for
example <b><b>Gabriel Iglesias</b></b> belongs to both 18 Latin and 22 Comedy, not quite
sure this is correct.</li>

<li>The process also updates category_ids, for proper matching.</li>

<li>Well, we got a number of typos in yey_subcategory:
<ul class="org-ul">
<li>SacrAmento : SacrEmento</li>
<li>Iliza Schesinger : Iliza Schlesinger</li>
</ul></li>
<li>Also team similarities
<ul class="org-ul">
<li>Buffalo Bulls : Buffalo Bills</li>
</ul></li>
<li>Balance?
<ul class="org-ul">
<li>towards false positives or false negatives?</li>
</ul></li>

<li>Anyway, after n rounds of iterations and testing, settled down on hamming
algorithm. Commit is ready to be tested.</li>
</ul>
</div>
</li>
</ol>
</div>
<div id="outline-container-org484824d" class="outline-4">
<h4 id="org484824d"><span class="section-number-4">1.4.4</span> <span class="done DONE">DONE</span> Further Analysis and Report</h4>
<div class="outline-text-4" id="text-1-4-4">
<p>
Major lessons learned here:
</p>
<ol class="org-ol">
<li>We need to go through subcategories and check for typos and alike.</li>
<li>We might have to take some hit and miss matches to avoid false positives as much as possible, for example in small words single character mismatch =&gt; similarity below 0.9, but that is supposed to be tackled by introduced jaro winkler algorithm into the system, on top of Levenshtein.</li>
<li>Absolute majority of matches don't require algorithmic check as subcategory
names are mostly substrings of titles - 92.4%, 232 out of 251 [unique subcategories].</li>
<li>BUT 7.6% of similarities [19 in total] found by employing algorithms
translates into 203 events, overall.</li>

<li><p>
(Unique) similarities caught by algorithms, if 0.8 &lt; sim &lt; 0.9 -&gt; we also
compute Jaro/Winkler similarity index, and threshold for jw is 0.95, major
algorithm (Jaccard) threshold is 0.9.
</p>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-right" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-right">&#xa0;</th>
<th scope="col" class="org-left">title</th>
<th scope="col" class="org-left">title_sub</th>
<th scope="col" class="org-left">subcat</th>
<th scope="col" class="org-right">similarity</th>
<th scope="col" class="org-right">jaro_winkler</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-right">0</td>
<td class="org-left">Army Black Knights Football vs. Buffalo Bulls &#x2026;</td>
<td class="org-left">Buffalo Bulls</td>
<td class="org-left">Buffalo Bills</td>
<td class="org-right">0.857143</td>
<td class="org-right">0.969231</td>
</tr>

<tr>
<td class="org-right">2</td>
<td class="org-left">Lehigh Valley IronPigs at Scranton Wilkes-Barr&#x2026;</td>
<td class="org-left">Lehigh Valley IronPigs at</td>
<td class="org-left">Lehigh Valley Iron Pigs</td>
<td class="org-right">0.920000</td>
<td class="org-right">0.000000</td>
</tr>

<tr>
<td class="org-right">3</td>
<td class="org-left">Pawtucket Red Sox at Lehigh Valley IronPigs</td>
<td class="org-left">at Lehigh Valley IronPigs</td>
<td class="org-left">Lehigh Valley Iron Pigs</td>
<td class="org-right">0.920000</td>
<td class="org-right">0.000000</td>
</tr>

<tr>
<td class="org-right">20</td>
<td class="org-left">Norfolk Tides vs. Lehigh Valley IronPigs</td>
<td class="org-left">vs Lehigh Valley IronPigs</td>
<td class="org-left">Lehigh Valley Iron Pigs</td>
<td class="org-right">0.920000</td>
<td class="org-right">0.000000</td>
</tr>

<tr>
<td class="org-right">31</td>
<td class="org-left">Omaha Storm Chasers at Memphis Redbirds</td>
<td class="org-left">Memphis Redbirds</td>
<td class="org-left">Memphis Red Birds</td>
<td class="org-right">0.833333</td>
<td class="org-right">0.963971</td>
</tr>

<tr>
<td class="org-right">48</td>
<td class="org-left">Tacoma Rainiers at Sacramento River Cats</td>
<td class="org-left">Sacramento River Cats</td>
<td class="org-left">Sacremento River Cats</td>
<td class="org-right">0.909091</td>
<td class="org-right">0.000000</td>
</tr>

<tr>
<td class="org-right">86</td>
<td class="org-left">Lehigh Valley IronPigs at Scranton Wilkes-Barr&#x2026;</td>
<td class="org-left">Scranton Wilkes Barre RailRiders</td>
<td class="org-left">Scranton Wilkes-Barre Rail Riders</td>
<td class="org-right">0.969697</td>
<td class="org-right">0.000000</td>
</tr>

<tr>
<td class="org-right">127</td>
<td class="org-left">Pawtucket Redsox vs. Toledo Mudhens</td>
<td class="org-left">Toledo Mudhens</td>
<td class="org-left">Toledo Mud Hens</td>
<td class="org-right">0.812500</td>
<td class="org-right">0.959048</td>
</tr>

<tr>
<td class="org-right">129</td>
<td class="org-left">Boston Symphony Orchestra: Andris Nelsons cond&#x2026;</td>
<td class="org-left">Yo Yo Ma</td>
<td class="org-left">Yo Yo Ma</td>
<td class="org-right">1.000000</td>
<td class="org-right">0.000000</td>
</tr>

<tr>
<td class="org-right">131</td>
<td class="org-left">Yo-Yo Mas Goat Rodeo Sessions featuring Stuart&#x2026;</td>
<td class="org-left">Yo Yo Mas</td>
<td class="org-left">Yo Yo Ma</td>
<td class="org-right">0.888889</td>
<td class="org-right">0.977778</td>
</tr>

<tr>
<td class="org-right">134</td>
<td class="org-left">Aint Too Proud New York</td>
<td class="org-left">Aint Too Proud</td>
<td class="org-left">Ain't Too Proud</td>
<td class="org-right">0.933333</td>
<td class="org-right">0.000000</td>
</tr>

<tr>
<td class="org-right">138</td>
<td class="org-left">Come from Away</td>
<td class="org-left">Come from Away</td>
<td class="org-left">Come From Away</td>
<td class="org-right">0.866667</td>
<td class="org-right">0.971429</td>
</tr>

<tr>
<td class="org-right">139</td>
<td class="org-left">Kiss Me Kate Lincolnshire</td>
<td class="org-left">Kiss Me Kate</td>
<td class="org-left">Kiss Me, Kate</td>
<td class="org-right">0.923077</td>
<td class="org-right">0.000000</td>
</tr>

<tr>
<td class="org-right">140</td>
<td class="org-left">Moulin Rouge The Musical New York</td>
<td class="org-left">Moulin Rouge</td>
<td class="org-left">Moulin Rouge!</td>
<td class="org-right">0.923077</td>
<td class="org-right">0.000000</td>
</tr>

<tr>
<td class="org-right">143</td>
<td class="org-left">Oklahoma City Philharmonic: Gritty, Sweet And &#x2026;</td>
<td class="org-left">Oklahoma</td>
<td class="org-left">Oklahoma!</td>
<td class="org-right">0.888889</td>
<td class="org-right">0.977778</td>
</tr>

<tr>
<td class="org-right">152</td>
<td class="org-left">The Bands Visit Durham</td>
<td class="org-left">The Bands Visit</td>
<td class="org-left">The Band's Visit</td>
<td class="org-right">0.937500</td>
<td class="org-right">0.000000</td>
</tr>

<tr>
<td class="org-right">172</td>
<td class="org-left">Chris DElia</td>
<td class="org-left">Chris DElia</td>
<td class="org-left">Chris D'Elia</td>
<td class="org-right">0.916667</td>
<td class="org-right">0.000000</td>
</tr>

<tr>
<td class="org-right">178</td>
<td class="org-left">Iliza Shlesinger</td>
<td class="org-left">Iliza Shlesinger</td>
<td class="org-left">Iliza Schesinger</td>
<td class="org-right">0.882353</td>
<td class="org-right">0.975000</td>
</tr>

<tr>
<td class="org-right">193</td>
<td class="org-left">Jim Jefferies</td>
<td class="org-left">Jim Jefferies</td>
<td class="org-left">Jim Jeffries</td>
<td class="org-right">0.923077</td>
<td class="org-right">0.000000</td>
</tr>
</tbody>
</table></li>

<li><p>
Summary
</p>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-right" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Type of match</th>
<th scope="col" class="org-right">Number of unique matches</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">algorithm(s)</td>
<td class="org-right">19</td>
</tr>

<tr>
<td class="org-left">exact [substr]</td>
<td class="org-right">232</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-left">Total</td>
<td class="org-right">251</td>
</tr>
</tbody>
</table></li>

<li>A complete Jupyter notebook report - <a href="http://yey.chokhe.li/subcategory-extraction/">subcategory-extraction</a></li>
</ol>
</div>
</div>
</div>

<div id="outline-container-org8543fa3" class="outline-3">
<h3 id="org8543fa3"><span class="section-number-3">1.5</span> QA</h3>
<div class="outline-text-3" id="text-1-5">
</div>
<div id="outline-container-org6ca576d" class="outline-4">
<h4 id="org6ca576d"><span class="section-number-4">1.5.1</span> <span class="done DONE">DONE</span> More events than tickets</h4>
<div class="outline-text-4" id="text-1-5-1">
<p>
Okay, it turns out more than 50% of events (<b><b>yey_events</b></b>) don't have
corresponding tickets in the <b><b>yey_tickets</b></b> table. This issue doesn't seem to
affect <b><b>yey_events_clean</b></b> table though. But we might have to clean events
according ticket availability upon query into the recommender system.
</p>
</div>
</div>
<div id="outline-container-orgc2866a4" class="outline-4">
<h4 id="orgc2866a4"><span class="section-number-4">1.5.2</span> <span class="done DONE">DONE</span> The Structural Exploration</h4>
<div class="outline-text-4" id="text-1-5-2">
</div>
</div>
<div id="outline-container-org26b7d71" class="outline-4">
<h4 id="org26b7d71"><span class="section-number-4">1.5.3</span> <span class="done DONE">DONE</span> Data</h4>
<div class="outline-text-4" id="text-1-5-3">
<p>
Check if all column that are used in the process contain relevant data
</p>
</div>
</div>
<div id="outline-container-org1edfcc4" class="outline-4">
<h4 id="org1edfcc4"><span class="section-number-4">1.5.4</span> <span class="done DONE">DONE</span> Go through the process</h4>
<div class="outline-text-4" id="text-1-5-4">
<p>
Well, we can slowly move to Test Driven Development and introduce tests, but it'll take time.
</p>
</div>
</div>
</div>

<div id="outline-container-orgfd49cb3" class="outline-3">
<h3 id="orgfd49cb3"><span class="section-number-3">1.6</span> Errands</h3>
<div class="outline-text-3" id="text-1-6">
</div>
<div id="outline-container-orgeff6a37" class="outline-4">
<h4 id="orgeff6a37"><span class="section-number-4">1.6.1</span> <span class="todo TODO">TODO</span> XLS file to Database</h4>
</div>
<div id="outline-container-org27963c1" class="outline-4">
<h4 id="org27963c1"><span class="section-number-4">1.6.2</span> <span class="done DONE">DONE</span> cleanup branches</h4>
</div>
</div>
</div>

<div id="outline-container-org3ac02f2" class="outline-2">
<h2 id="org3ac02f2"><span class="section-number-2">2</span> May</h2>
<div class="outline-text-2" id="text-2">
</div>
<div id="outline-container-org2156373" class="outline-3">
<h3 id="org2156373"><span class="section-number-3">2.1</span> <span class="done DONE">DONE</span> QA</h3>
<div class="outline-text-3" id="text-2-1">
<p>
Well, it's an ongoing process, we can slowly move to TDD.
</p>
</div>
</div>
<div id="outline-container-org2f32985" class="outline-3">
<h3 id="org2f32985"><span class="section-number-3">2.2</span> <span class="done DONE">DONE</span> Cheapest Ticket</h3>
<div class="outline-text-3" id="text-2-2">
<p>
Well, this one was already implemented, I made a mistake in evaluating the code.
</p>
</div>
</div>
<div id="outline-container-orgda1b827" class="outline-3">
<h3 id="orgda1b827"><span class="section-number-3">2.3</span> <span class="done DONE">DONE</span> YEY Structural Report</h3>
</div>
<div id="outline-container-orga5b31c4" class="outline-3">
<h3 id="orga5b31c4"><span class="section-number-3">2.4</span> <span class="done DONE">DONE</span> Price Drop Detector</h3>
<div class="outline-text-3" id="text-2-4">
<p>
Search through different sources, integrate yey_eventlookup table into the process.
</p>
<ul class="org-ul">
<li>So, after a number of iterations and attampts, instead of getting all different data into Python including duplicates and then reprocessing it, a little complication of ticket fetching query did the great job! So, this logic is outsourced to queries.sql file.</li>
<li>What trick?<br />
<ul class="org-ul">
<li>Upon querying tickets, event_ids are replace by the <b><b>original id</b></b><sup><a id="fnr.1" class="footref" href="#fn.1">1</a></sup> from <b><b>yey_eventlookup</b></b></li>
<li>In the process the cheapest ticket is being picked and the rest dropped per event.</li>
<li>That's it.</li>
</ul></li>
<li>Questions:
<ul class="org-ul">
<li>We're checking for all tickets from now[or last run of PDD] to the max date of all tickets. I don't think need it, because we're looking for events 21 days in the future.</li>
</ul></li>
</ul>
</div>
</div>
<div id="outline-container-org5afc2cd" class="outline-3">
<h3 id="org5afc2cd"><span class="section-number-3">2.5</span> <span class="done DONE">DONE</span> Location Based Recommendations</h3>
<div class="outline-text-3" id="text-2-5">
<ul class="org-ul">
<li class="on"><code>[X]</code> Integrate lat/long into cleaner: it was already done.</li>
<li class="on"><code>[X]</code> Define incremental steps for distance:<br />
config.yml: DISTANCE_STEPS: [15, 40, 60, 100, 130]</li>
<li class="on"><code>[X]</code> Define a number of satisfactory results: 20?
P.S. We execute it after premium filtering, just in case.</li>
<li class="on"><code>[X]</code> Implement into the recommender</li>
<li class="on"><code>[X]</code> Sort events by score</li>
<li class="off"><code>[&#xa0;]</code> Settle down on sound amount of events and also about 5 steps.</li>
</ul>


<ul class="org-ul">
<li>Additional Observations / Questions
<ul class="org-ul">
<li>Do we keep only events w/o location data?</li>
<li>Test db: we don't have yey_eventclean/eventlookup in the test db, how do we solve this?</li>
<li>Only 2 users wit lat/lon data</li>
<li>Score/distance: should we play with it?</li>
<li>PockerNews: do we plan to include it?</li>
</ul></li>

<li>We have a case when a user doesn't have any events</li>
<li>Score or distance? <br />
We have incremental search for tickets, based on location: DISTANCE_STEPS: [15, 40, 60, 100, 130], and my question is what do you think should we give priority to score over the distance?<br />
Also, I'm picking 12 events, closest to the user.</li>
</ul>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-left" />

<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-right">id</th>
<th scope="col" class="org-right">event_id</th>
<th scope="col" class="org-right">event_time</th>
<th scope="col" class="org-left">&#xa0;</th>
<th scope="col" class="org-right">score</th>
<th scope="col" class="org-right">distance</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-right">5888</td>
<td class="org-right">21754905</td>
<td class="org-right">2020-06-04</td>
<td class="org-left">&#x2026;</td>
<td class="org-right">1.183711</td>
<td class="org-right">4.480570</td>
</tr>

<tr>
<td class="org-right">6477</td>
<td class="org-right">21783188</td>
<td class="org-right">2020-06-05</td>
<td class="org-left">&#x2026;</td>
<td class="org-right">1.139777</td>
<td class="org-right">23.635297</td>
</tr>

<tr>
<td class="org-right">5775</td>
<td class="org-right">21725239</td>
<td class="org-right">2020-06-02</td>
<td class="org-left">&#x2026;</td>
<td class="org-right">1.106259</td>
<td class="org-right">44.063471</td>
</tr>

<tr>
<td class="org-right">6044</td>
<td class="org-right">21754817</td>
<td class="org-right">2020-06-03</td>
<td class="org-left">&#x2026;</td>
<td class="org-right">1.093655</td>
<td class="org-right">44.063471</td>
</tr>

<tr>
<td class="org-right">5887</td>
<td class="org-right">21728930</td>
<td class="org-right">2020-06-03</td>
<td class="org-left">&#x2026;</td>
<td class="org-right">0.982573</td>
<td class="org-right">4.480570</td>
</tr>

<tr>
<td class="org-right">5767</td>
<td class="org-right">21725227</td>
<td class="org-right">2020-06-02</td>
<td class="org-left">&#x2026;</td>
<td class="org-right">0.573484</td>
<td class="org-right">0.725678</td>
</tr>

<tr>
<td class="org-right">6466</td>
<td class="org-right">21778034</td>
<td class="org-right">2020-06-05</td>
<td class="org-left">&#x2026;</td>
<td class="org-right">0.523821</td>
<td class="org-right">2.793104</td>
</tr>

<tr>
<td class="org-right">6453</td>
<td class="org-right">21778016</td>
<td class="org-right">2020-06-05</td>
<td class="org-left">&#x2026;</td>
<td class="org-right">0.475728</td>
<td class="org-right">1.021999</td>
</tr>

<tr>
<td class="org-right">6105</td>
<td class="org-right">21754885</td>
<td class="org-right">2020-06-03</td>
<td class="org-left">&#x2026;</td>
<td class="org-right">0.393588</td>
<td class="org-right">7.701251</td>
</tr>

<tr>
<td class="org-right">5275</td>
<td class="org-right">21725258</td>
<td class="org-right">2020-06-02</td>
<td class="org-left">&#x2026;</td>
<td class="org-right">0.201049</td>
<td class="org-right">2.793104</td>
</tr>

<tr>
<td class="org-right">6322</td>
<td class="org-right">21777866</td>
<td class="org-right">2020-06-04</td>
<td class="org-left">&#x2026;</td>
<td class="org-right">0.035596</td>
<td class="org-right">44.063471</td>
</tr>
</tbody>
</table>
</div>

<div id="outline-container-org0a1747d" class="outline-4">
<h4 id="org0a1747d"><span class="section-number-4">2.5.1</span> <span class="done DONE">DONE</span> Unit Testing</h4>
<div class="outline-text-4" id="text-2-5-1">
<ul class="org-ul">
<li class="on"><code>[X]</code> Locations Based Recs / Recommender Utils</li>
</ul>
</div>
</div>
</div>

<div id="outline-container-org20fc153" class="outline-3">
<h3 id="org20fc153"><span class="section-number-3">2.6</span> <span class="done DONE">DONE</span> Restructure the project</h3>
<div class="outline-text-3" id="text-2-6">
<ul class="org-ul">
<li>a common config in src/config dir</li>
<li>a dir for queries with corresponding named files: rec_queries, cln_queries etc.</li>
<li>tests moved under the yey dir</li>
<li>for major packages: cleaner, pdd, recommender we have src directory</li>
<li>utils package delves under the src folder from now on, as well</li>
<li>Docker scripts: Entrypoints moved to docker directory</li>
</ul>
</div>

<div id="outline-container-orgd1725e3" class="outline-4">
<h4 id="orgd1725e3"><span class="section-number-4">2.6.1</span> New Structure</h4>
<div class="outline-text-4" id="text-2-6-1">
<div class="org-src-container">
<pre class="src src-sh">├── Dockerfile
├── README.adoc
├── artifacts
│   └── credentials.tmpl
├── data
├── docker
│   ├── entrypointAD.sh
│   ├── entrypointClean.sh
│   ├── entrypointDeRec.sh
│   ├── entrypointPDD.sh
│   └── entrypointRec.sh
├── docs
│   └── database_fields_premium.xlsx
├── logs
├── requirements.txt
├── setup.py
└── yey
    ├── config
    │   └── config.yml
    ├── queries
    │   ├── cln_queries.sql
    │   ├── pdd_queries.sql
    │   └── rec_queries.sql
    ├── src
    │   ├── cleaner
    │   │   ├── __init__.py
    │   │   └── cleaner.py
    │   ├── priceDropDetector
    │   │   ├── __init__.py
    │   │   └── priceDropDetector.py
    │   ├── recommender
    │   │   ├── __init__.py
    │   │   ├── anomalyDetector.py
    │   │   └── recommender.py
    │   └── utils
    │       ├── __init__.py
    │       ├── common.py
    │       ├── dbutils.py
    │       ├── logs.py
    │       ├── priceDropDetectorUtils.py
    │       ├── recomenderUtils.py
    │       └── s3utils.py
    └── tests
        ├── __init__.py
        ├── config
        │   ├── config.yml
        │   └── queries.sql
        ├── test_data
        │   ├── rec_utils_data.pkl
        │   ├── rec_utils_data_result.pkl
        │   ├── recommend_events_data.pkl
        │   ├── recommend_events_data_result.pkl
        │   └── recommender_data.pkl
        ├── test_recommenderUtils.py
        ├── test_system.py
        └── tests_utils.py


</pre>
</div>
</div>
</div>
</div>
</div>

<div id="outline-container-org785278a" class="outline-2">
<h2 id="org785278a"><span class="section-number-2">3</span> June</h2>
<div class="outline-text-2" id="text-3">
</div>
<div id="outline-container-orgc9a961e" class="outline-3">
<h3 id="orgc9a961e"><span class="section-number-3">3.1</span> <span class="done DONE">DONE</span> System Testing: the beginning</h3>
<div class="outline-text-3" id="text-3-1">
<p>
We need to integrate system testing in the process, to avoid redundant debugging and production failures.
</p>
<ul class="org-ul">
<li class="on"><code>[X]</code> Well the beginning and a wholesome implementation is done in `tests/test_system.py`, but we need to think more and code up a proper solution.</li>
</ul>
</div>
</div>

<div id="outline-container-orgc5599e3" class="outline-3">
<h3 id="orgc5599e3"><span class="section-number-3">3.2</span> <span class="done DONE">DONE</span> Dev / Prod envs</h3>
<div class="outline-text-3" id="text-3-2">
<p>
To automaticlly diferentiate Dev and Prod environment for keeping production database intact and use test db for dev purposes.
</p>
<ul class="org-ul">
<li>How does it work?<br />
A function <b><b>get_dev_or_prod_dir</b></b> takes care of the ptask of differentiating between branches, if master then returns prod environment dir, otherwise test production dir. Manual override is possible if we explicitly pass the argument prod=True to the function, in that case it returns the prod. configs/queries.</li>
</ul>
</div>
</div>

<div id="outline-container-org0da6de7" class="outline-3">
<h3 id="org0da6de7"><span class="section-number-3">3.3</span> <span class="todo TODO">TODO</span> Small tasks</h3>
<div class="outline-text-3" id="text-3-3">
<ul class="org-ul">
<li class="on"><code>[X]</code> Take care of Docker after restructuring the project
<ul class="org-ul">
<li class="on"><code>[X]</code> Check production variables for the docker image</li>
<li>Comments:
<ul class="org-ul">
<li>scripts under `src`</li>
<li>artifacts, configs, docker scripts, queries, data/logs, data/dump, data/docs went under resources dir</li>
<li>tests under `tests`
<ul class="org-ul">
<li>mocked test data under tests/test_data</li>
</ul></li>
<li>logs dir was putting logs on different locations due to not a very consistent nature of python, right now it's behaviour is consistent and after uploading log to s3 it removes logs files from project dir.</li>
<li>Dockerfile: little additions to make it work with new project structure and also read scripts from `resources/docker` dir.</li>
</ul></li>
</ul></li>
<li class="on"><code>[X]</code> Don't remove events that lack location data</li>
<li class="on"><code>[X]</code> Add logging to Location Based Recs</li>
<li class="on"><code>[X]</code> Test dir for logs in s3 bucket</li>
<li class="off"><code>[&#xa0;]</code> Add lat/lon to yey_city and validate or fill (absent data) user location data
<ul class="org-ul">
<li>Came across new open source project Graphhopper, which provides number of improvements over Nominatim, such as:
<ul class="org-ul">
<li>driving distance calculation</li>
<li>matrix API for calculating many to many distances, instead of one by one</li>
<li>Route optimization, etc.</li>
</ul></li>
</ul></li>
<li class="off"><code>[&#xa0;]</code> Alert Frequency: every day/twice a week, add condition to fetch users with alert frequency 2 [twice a week] if date is Monday of Thursday.]</li>
</ul>
</div>

<div id="outline-container-org4d538e1" class="outline-4">
<h4 id="org4d538e1"><span class="section-number-4">3.3.1</span> New Structure v2</h4>
<div class="outline-text-4" id="text-3-3-1">
<div class="org-src-container">
<pre class="src src-bash">.
├── Dockerfile
├── README.adoc
├── requirements.txt
├── resources
│   ├── artifacts
│   │   └── credentials.tmpl
│   ├── config
│   │   └── config.yml
│   ├── data
│   │   ├── docs
│   │   │   └── database_fields_premium.xlsx
│   │   ├── dumps
│   │   └── logs
│   ├── docker
│   │   ├── entrypointAD.sh
│   │   ├── entrypointClean.sh
│   │   ├── entrypointDeRec.sh
│   │   ├── entrypointPDD.sh
│   │   └── entrypointRec.sh
│   └── queries
│       ├── cln_queries.sql
│       ├── pdd_queries.sql
│       └── rec_queries.sql
├── setup.py
├── src
│   ├── cleaner
│   │   ├── __init__.py
│   │   └── cleaner.py
│   ├── pdd
│   │   ├── PriceDropDetector.py
│   │   └── __init__.py
│   ├── recommender
│   │   ├── __init__.py
│   │   ├── anomalyDetector.py
│   │   └── recommender.py
│   └── utils
│       ├── __init__.py
│       ├── common.py
│       ├── dbutils.py
│       ├── logs.py
│       ├── pricedropdetector_utils.py
│       ├── recomender_utils.py
│       └── s3utils.py
└── tests
    ├── config
    │   └── config.yml
    ├── queries
    │   ├── cln_queries.sql
    │   ├── pdd_queries.sql
    │   └── rec_queries.sql
    ├── test_data
    │   ├── rec_utils_data.pkl
    │   ├── rec_utils_data_result.pkl
    │   ├── recommend_events_data.pkl
    │   └── recommend_events_data_result.pkl
    ├── test_recommenderutils.py
    ├── test_system.py
    └── tests_utils.py
</pre>
</div>
</div>
</div>
</div>
</div>
<div id="footnotes">
<h2 class="footnotes">Footnotes: </h2>
<div id="text-footnotes">

<div class="footdef"><sup><a id="fn.1" class="footnum" href="#fnr.1">1</a></sup> <div class="footpara"><p class="footpara">
original id is mapped to  duplicate events: yey_eventclean [id] -&gt; yey_eventlookup [original id]
</p></div></div>


</div>
</div></div>
<div id="postamble" class="status">
<p class="author">Author: Giga Chokheli</p>
<p class="date">Created: 2020-06-08 Mon 16:15</p>
<p class="validation"><a href="http://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
